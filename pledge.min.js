/*
 *
 * Copyright 2014 Tony Quetano under the terms of the MIT
 * license found at https://github.com/planttheidea/bolster/MIT_License.txt
 *
 * pledge.js - A compact library to provide simple promise functionality
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
*/
(function(e,h){var f=function(a){throw Error(a);};errors={badParam:"Parameter passed is not a valid type for this method.",testFailed:"Test did not pass."};f=function(a){throw Error(a);};type=function(a){return Object.prototype.toString.call(a).replace(/^\[object (.+)\]$/,"$1").toLowerCase()};Pledge=function(){this.init=function(){this.resolved={};this.rejected={};this.cuid=this.puid=-1};this.resolve=function(a){this.cuid++;this.resolved[this.cuid]&&this.resolved[this.cuid].call(this,a)};this.reject=
function(a){this.cuid++;this.rejected[this.cuid]&&this.rejected[this.cuid].call(this,a)};this.push=function(a,b){this.puid++;"function"===type(a)?this.resolved[this.puid]=a:this.resolved[this.puid]=void 0;"function"===type(b)?this.rejected[this.puid]=b:this.rejected[this.puid]=function(a){f("Rejected: "+(a||""))}};this.init();return this};Postpone=function(){var a=this;this.resolve=function(a){this.resolvePostpone=!0;this.resolveData=a};this.reject=function(a){this.rejectPostpone=!0;this.rejectData=
a};this.pledge=function(){return(new Pledge).start(function(){a.resolvePostpone?this.resolve(a.resolveData):a.rejectPostpone&&this.reject(a.rejectData)})}};Pledge.prototype={complete:function(a,b){this.push(a,b)},consecutive:function(a,b){var d=type(b),c=!1;switch(d){case "array":case "function":case "undefined":c=!0;break;default:c=!1}if("array"===type(a)&&c){for(var d="array"===d,c=0,e=a.length;c<e;c++)d?this.push(a[c],b[c]):this.push(a[c],b);return this}f(errors.badParam)},concurrent:function(a,
b){var d=!1;switch(type(onRejections)){case "function":case "undefined":d=!0;break;default:d=!1}if(d){var c=function(a,b,c){(new Pledge).start(function(){a.call(this,c)}).complete(function(a){g.push(a);g.length===e&&b.resolve(g)})},e=a.length,g=[];return this.proceed(function(b){for(var d=e;d--;)c(a[d],this,b)},b)}f(errors.badParam)},proceed:function(a,b){this.push(a,b);return this},start:function(a){if("function"===type(a)){var b=this;e.setTimeout(function(){a.call(b)},0);return b}},wait:function(a,
b){var d=this,c;a||f(errors.badParam);switch(type(b)){case "boolean":c=b;break;case "function":c=b();break;default:c=!0}return d.proceed(function(b){e.setTimeout(function(){c?d.resolve.call(d,b):d.reject.call(d,errors.testFailed)},a)})}};e.Pledge||(e.Pledge=function(a){if("function"===type(a))return(new Pledge).start(a);f("Must pass function into Pledge().")});e.Postpone||(e.Postpone=function(){return new Postpone})})(window,document);
